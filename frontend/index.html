<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">

    <link rel="stylesheet" href="portugol-studio-dark.css">

    <title>Document</title>
</head>
<body onload="onLoad()">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>

    <!-- and it's easy to individually load additional languages -->

    <script>
    hljs.highlightAll();
    </script>

<script>

    function loadExercice(){
        console.log("a")
        fetch("http://localhost:3000/exercice/",{
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
                
                "name": localStorage.getItem("name")
            },
        }).then(async (response) => {
            const data = await response.json();
            
            if(response.status == 500){
                alert(data.message);
                loadExercice();
            }else{
            document.exerciceId = data.id;
            document.getElementById("enunciado").innerHTML = data.statement;
            }

        }).catch((err) => {
            console.log(err);
            alert("Erro ao carregar exercício");
        })
    }

    function onLoad(){
        if(localStorage.getItem("name") == null){
            const nome = prompt("Digite seu nome");
            if(nome == ""){
                alert("Você precisa digitar seu nome para continuar");
                onLoad();
            }
            localStorage.setItem("name", nome);
        }
        loadExercice()
    }
    function enviar(){
        const codigo = document.getElementById("codigo").value;
        fetch("http://localhost:3000/exercice/submit",{
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
                        
            },
            body: JSON.stringify({
                exerciceId: document.exerciceId,
                code: codigo,
                name: localStorage.getItem("name"),
            })
        }).then(async (response) => {

            const data = await response.json();

            if(response.status == 200){
                alert(data.message)
                console.log(data);

                loadExercice()

            }else{
                alert(data.message);
            }

        }).catch((err) => {
            alert("Erro ao enviar exercício");
        })
    }
</script>

<h4 id="enunciado">Enunciado</h4>

<textarea class="hljs portugol" id="codigo" contenteditable="true" spellcheck="false"></textarea>
<button onclick="enviar()">Enviar</button>

</body>
</html>